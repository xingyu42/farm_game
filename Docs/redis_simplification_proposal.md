# Redis 架构简化方案报告

## 1. 核心决策：回归简单

经过深入评估，我们决定对项目当前的 Redis 使用方式进行战略性简化。核心决策如下：

**将所有核心玩家数据（资产、状态等）统一存储到 YAML 文件中，使其成为唯一的数据源。**

此决策基于项目当前处于**测试阶段**的核心上下文，其首要目标是**保证系统稳定、降低维护成本、提高迭代速度**，而非追求极致的性能。

## 2. Redis 的新角色：轻量级协调器

在简化架构下，Redis 不再作为主数据库，而是退居二线，扮演一个不可或缺的、轻量级的**“协调与状态管理器”**角色。其必须保留的三大核心功能是：

1.  **分布式锁**: 保证并发操作时 YAML 文件写入的原子性和安全性。这是新架构的**正确性基石**。
2.  **带自动过期的临时状态 (TTL)**: 用于干净、无污染地管理冷却时间、保护期等临时状态。这是**简洁性的关键**。
3.  **原子计数器**: 用于高效、正确地实现每日次数限制等功能。

## 3. 对核心系统的积极影响

此简化方案将对项目产生深远的积极影响：

*   **风险消除**: 彻底移除了原架构中因“混合存储”和“假事务”带来的数据一致性风险。
*   **技术债偿还**: 大幅削减了代码复杂性，解决了代码重复、设计缺陷等问题。
*   **架构优化**: 迫使**种植系统**等核心模块放弃了复杂的后台监控模式，转而采用更优雅、更健壮的**“按需计算”**模型，该模型同样适用于处理土地的异常状态（如长草、干旱）。

## 4. 架构反思：我们学到了什么？

本次评估过程本身是一次宝贵的架构演练，核心反思如下：

*   **上下文压倒一切**: 最好的架构并非技术最先进的，而是最适合项目当前阶段和需求的。
*   **拥抱简单性**: “消除复杂”通常比“修复复杂”是更好的选择。最简单的方案往往最健壮。
*   **识别核心价值**: 我们准确识别了 Redis 在本方案中不可替代的核心价值（原子性与时效性），并剥离了所有非核心功能。

## 5. 最终结论

通过将 Redis 的职责最小化，我们用可接受的性能代价，换来了**系统复杂度的急剧下降、代码可维护性的大幅提升和核心逻辑的健壮性**。这是在项目当前阶段最明智的架构选择，为未来的健康发展铺平了道路。