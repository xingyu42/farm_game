# 物品锁定功能使用指南

## 功能概述

物品锁定功能允许玩家锁定重要物品，防止意外出售。被锁定的物品将无法通过 `#nc出售` 或 `#nc出售全部` 命令出售。

## 用户命令

### 1. 锁定物品
```
#nc锁定 [物品名]
#锁定 [物品名]
```

**示例：**
```
#nc锁定 小麦
#锁定 玉米种子
```

**功能：**
- 锁定指定物品，防止被出售
- 只能锁定仓库中已有的物品
- 锁定后物品会显示 🔒 图标

### 2. 解锁物品
```
#nc解锁 [物品名]
#解锁 [物品名]
```

**示例：**
```
#nc解锁 小麦
#解锁 玉米种子
```

**功能：**
- 解锁指定物品，允许出售
- 只能解锁已锁定的物品

### 3. 查看锁定物品
```
#nc查看锁定
#nc锁定列表
#查看锁定
#锁定列表
```

**功能：**
- 显示所有已锁定的物品
- 按类别分组显示
- 如果没有锁定物品会提示相应信息

### 4. 查看仓库（已更新）
```
#nc仓库
#仓库
```

**更新内容：**
- 锁定的物品会显示 🔒 图标
- 新增锁定相关的帮助提示

## 使用场景

### 1. 保护珍贵物品
```
#nc锁定 传说种子
```
防止意外出售稀有或珍贵的物品。

### 2. 保留制作材料
```
#nc锁定 高级肥料
#nc锁定 土地改良剂
```
保留用于制作或升级的重要材料。

### 3. 批量管理
```
#nc查看锁定
```
查看所有锁定物品，统一管理。

## 技术实现

### 数据存储
- 锁定状态存储在 `playerData.inventory[itemId].locked` 字段
- 锁定时间存储在 `playerData.inventory[itemId].lockedAt` 字段

### 防护机制
- 出售功能会检查物品锁定状态
- 事务内双重检查，防止并发问题
- 批量出售也会跳过锁定物品

### 错误处理
- 物品不存在时的友好提示
- 重复锁定/解锁的处理
- 服务异常时的错误恢复

## 注意事项

1. **物品名称匹配**：必须使用准确的物品名称，区分大小写
2. **仓库要求**：只能锁定仓库中已有的物品
3. **锁定持久性**：锁定状态会持久保存，直到手动解锁
4. **出售保护**：锁定物品无法通过任何出售命令出售

## 示例对话

```
用户: #nc仓库
机器人: 🎒 仓库状态 (15/20)
━━━━━━━━━━━━━━━━━━━━
📦 作物
   🔒小麦 x10 (售价: 5金币)
   玉米 x5 (售价: 8金币)
━━━━━━━━━━━━━━━━━━━━
💡 使用 #nc锁定 [物品名] 锁定物品

用户: #nc出售 小麦 5
机器人: ❌ 小麦 已被锁定，无法出售

用户: #nc解锁 小麦
机器人: 🔓 成功解锁 小麦

用户: #nc锁定 玉米
机器人: 🔒 成功锁定 玉米

用户: #nc查看锁定
机器人: 🔒 锁定物品列表 (1 个)
━━━━━━━━━━━━━━━━━━━━
📦 作物
   🔒玉米 x5
━━━━━━━━━━━━━━━━━━━━
💡 使用 #nc解锁 [物品名] 解锁物品
```

## 开发者信息

- **实现文件**：`apps/inventory.js`, `services/InventoryService.js`
- **依赖服务**：`ItemResolver`, `PlayerService`
- **数据库字段**：`inventory[itemId].locked`, `inventory[itemId].lockedAt`
- **测试文件**：`test_lock_commands.js`
