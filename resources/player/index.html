<!DOCTYPE html>
<html lang="zh-CN" data-theme="garden">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>玩家信息</title>
    <link rel="stylesheet" href="../common/lib/daisyui.css">
    <script src="../common/lib/vue.js"></script>
    <script src="../common/lib/unocss.js"></script>
    <script src="../common/lib/iconify.js"></script>
    <style>
        [v-cloak] { display: none; }
        .bg-farm { background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); }
        .glass { background: rgba(255,255,255,0.85); backdrop-filter: blur(12px); }
    </style>
</head>
<body class="bg-farm min-h-screen p-6 font-sans">

<div id="app" v-cloak class="bg-farm w-[520px] p-5 flex flex-col gap-4">

    <!-- Header -->
    <div class="glass rounded-2xl p-4 shadow-md flex items-center gap-3">
        <div class="w-16 h-16 rounded-full overflow-hidden shadow-lg ring-2 ring-green-400 ring-offset-2">
            <img :src="avatarUrl" class="w-full h-full object-cover" />
        </div>
        <div class="flex-1">
            <div class="text-xl font-extrabold text-green-700">{{ playerName }} 的农场</div>
            <div class="badge badge-ghost text-xs mt-1">ID: {{ oderId }}</div>
        </div>
        <div class="badge badge-warning badge-lg font-bold text-lg px-4 py-3 shadow">Lv.{{ level }}</div>
    </div>

    <!-- Stats -->
    <div class="glass rounded-2xl p-4 shadow-md flex flex-col gap-3">
        <!-- EXP Bar -->
        <div class="flex items-center gap-3">
            <span class="text-xs font-bold text-green-700 w-8">EXP</span>
            <div class="flex-1 h-5 bg-black/10 rounded-full relative overflow-hidden shadow-inner">
                <div class="h-full bg-[linear-gradient(to_right,#4ade80,#16a34a)] rounded-full transition-all duration-500"
                     :style="{ width: expPercentage + '%' }"></div>
                <span class="absolute inset-0 flex items-center justify-center text-[11px] font-bold text-white drop-shadow">
                    {{ experience }} / {{ experienceToNext }}
                </span>
            </div>
        </div>

        <!-- Unlock Preview -->
        <div v-if="nextUnlocksText" class="flex items-center gap-3 bg-green-50/60 p-2 rounded-xl border border-dashed border-green-300">
            <span class="text-xs font-bold text-green-700 w-8">解锁</span>
            <span class="text-[11px] text-green-700 font-semibold">Lv.{{ nextLevel }}：{{ nextUnlocksText }}</span>
        </div>

        <!-- Core Stats -->
        <div class="grid grid-cols-3 gap-3">
            <div class="bg-amber-50/60 rounded-xl p-3 text-center border border-amber-200/50">
                <span class="iconify text-2xl block" data-icon="twemoji:money-bag"></span>
                <span class="text-sm font-bold text-stone-800 block">{{ coins }}</span>
                <span class="text-[10px] text-stone-500">金币</span>
            </div>
            <div class="bg-amber-50/60 rounded-xl p-3 text-center border border-amber-200/50">
                <span class="iconify text-2xl block" data-icon="twemoji:national-park"></span>
                <span class="text-sm font-bold text-stone-800 block">{{ landCount }} / {{ maxLandCount }}</span>
                <span class="text-[10px] text-stone-500">土地</span>
            </div>
            <div class="bg-amber-50/60 rounded-xl p-3 text-center border border-amber-200/50">
                <span class="iconify text-2xl block" data-icon="twemoji:package"></span>
                <span class="text-sm font-bold text-stone-800 block">{{ inventoryUsage }} / {{ inventoryCapacity }}</span>
                <span class="text-[10px] text-stone-500">仓库</span>
            </div>
        </div>
    </div>

    <!-- Protection -->
    <div class="glass rounded-2xl p-4 shadow-md">
        <div class="text-sm font-bold text-stone-700 pb-2 mb-3 border-b-2 border-dashed border-stone-200"><span class="iconify inline-block align-middle" data-icon="twemoji:shield"></span> 农场防护</div>
        <div class="flex gap-3">
            <div class="flex-1 bg-[linear-gradient(135deg,#eff6ff,#dbeafe)] rounded-xl p-3 flex items-center gap-3 border border-blue-200">
                <span class="iconify text-2xl" data-icon="twemoji:castle"></span>
                <div class="flex flex-col">
                    <span class="text-[11px] text-slate-500 font-bold">基础防御</span>
                    <span class="text-sm font-bold text-slate-800">+{{ defenseBonus }}%</span>
                </div>
            </div>
            <div class="flex-1 bg-[linear-gradient(135deg,#fff7ed,#ffedd5)] rounded-xl p-3 flex items-center gap-3 border border-orange-200">
                <span class="iconify text-2xl" data-icon="twemoji:dog"></span>
                <div class="flex flex-col">
                    <span class="text-[11px] text-orange-700 font-bold">看家萌宠</span>
                    <template v-if="dogFoodActive">
                        <span class="text-sm font-bold text-orange-800">{{ dogFoodName }}</span>
                        <span class="text-[10px] text-stone-500">+{{ dogFoodBonus }}% | 剩余 {{ dogFoodRemaining }}分钟</span>
                    </template>
                    <template v-else>
                        <span class="text-sm font-bold text-orange-800">未激活</span>
                        <span class="text-[10px] text-stone-500">使用狗粮激活防护</span>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <!-- Steal Status -->
    <div class="glass rounded-2xl p-4 shadow-md">
        <div class="flex items-center pb-2 mb-3 border-b-2 border-dashed border-stone-200">
            <span class="text-sm font-bold text-stone-700"><span class="iconify inline-block align-middle" data-icon="twemoji:ninja"></span> 偷菜情报</span>
            <span v-if="canSteal" class="ml-auto badge badge-success badge-sm text-white">准备就绪</span>
            <span v-else class="ml-auto badge badge-error badge-sm text-white">冷却中 {{ stealCooldown }}分钟</span>
        </div>
        <div class="bg-stone-100/50 rounded-xl p-3 flex justify-between">
            <div class="flex flex-col items-center gap-1 text-[11px] text-stone-600">
                <span><span class="iconify inline-block align-middle" data-icon="twemoji:calendar"></span> 今日次数</span>
                <span class="text-sm font-bold text-stone-800">{{ todayStealCount }}</span>
            </div>
            <div class="flex flex-col items-center gap-1 text-[11px] text-stone-600">
                <span><span class="iconify inline-block align-middle" data-icon="twemoji:direct-hit"></span> 成功率</span>
                <span class="text-sm font-bold text-stone-800">{{ stealRate }}%</span>
            </div>
        </div>
    </div>

    <!-- Sign In Stats -->
    <div class="glass rounded-2xl p-4 shadow-md">
        <div class="flex justify-around bg-white/60 rounded-xl p-3">
            <div class="flex flex-col items-center gap-1">
                <span class="text-xs text-slate-500"><span class="iconify inline-block align-middle" data-icon="twemoji:calendar"></span> 总签到</span>
                <span class="text-lg font-bold text-blue-600">{{ totalSignDays }} 天</span>
            </div>
            <div class="flex flex-col items-center gap-1">
                <span class="text-xs text-slate-500"><span class="iconify inline-block align-middle" data-icon="twemoji:chart-increasing"></span> 连续签到</span>
                <span class="text-lg font-bold text-orange-500">{{ consecutiveDays }} 天</span>
            </div>
        </div>
    </div>

    <!-- Tips -->
    <div v-if="isNewPlayer" class="glass rounded-2xl p-4 shadow-md text-center">
        <div class="text-sm font-bold text-green-700 mb-1"><span class="iconify inline-block align-middle" data-icon="twemoji:party-popper"></span> 欢迎来到农场世界！</div>
        <div class="text-xs text-stone-600"><span class="iconify inline-block align-middle" data-icon="twemoji:light-bulb"></span> 输入 #nc帮助 查看游戏指令</div>
    </div>
    <div v-else class="glass rounded-2xl p-4 shadow-md text-center">
        <div class="text-xs text-stone-600"><span class="iconify inline-block align-middle" data-icon="twemoji:light-bulb"></span> 使用 #使用狗粮 激活防护</div>
    </div>

    <!-- Footer -->
    <div class="text-center text-[10px] text-stone-500/70 py-1">
        Generated by Miao-Yunzai Farm Plugin
    </div>
</div>

<script>
    const { createApp, ref, onMounted } = Vue;

    createApp({
        setup() {
            const s = window.FARM_DATA || {};

            const playerName = ref(s.playerName || '未知');
            const avatarUrl = ref(s.avatarUrl || '');
            const oderId = ref(s.oderId || '');
            const level = ref(s.level || 1);
            const expPercentage = ref(s.expPercentage || 0);
            const experience = ref(s.experience || 0);
            const experienceToNext = ref(s.experienceToNext || 0);
            const nextLevel = ref(s.nextLevel || 2);
            const nextUnlocksText = ref(s.nextUnlocksText || '');
            const coins = ref(s.coins || 0);
            const landCount = ref(s.landCount || 0);
            const maxLandCount = ref(s.maxLandCount || 0);
            const inventoryUsage = ref(s.inventoryUsage || 0);
            const inventoryCapacity = ref(s.inventoryCapacity || 0);
            const defenseBonus = ref(s.defenseBonus || 0);
            const dogFoodActive = ref(s.dogFoodActive || false);
            const dogFoodName = ref(s.dogFoodName || '');
            const dogFoodBonus = ref(s.dogFoodBonus || 0);
            const dogFoodRemaining = ref(s.dogFoodRemaining || 0);
            const canSteal = ref(s.canSteal || false);
            const stealCooldown = ref(s.stealCooldown || 0);
            const todayStealCount = ref(s.todayStealCount || 0);
            const stealRate = ref(s.stealRate || 0);
            const totalSignDays = ref(s.totalSignDays || 0);
            const consecutiveDays = ref(s.consecutiveDays || 0);
            const isNewPlayer = ref(s.isNewPlayer || false);

            onMounted(() => {
                document.body.classList.add('ready');
            });

            return {
                playerName, avatarUrl, oderId, level, expPercentage, experience, experienceToNext,
                nextLevel, nextUnlocksText, coins, landCount, maxLandCount,
                inventoryUsage, inventoryCapacity, defenseBonus,
                dogFoodActive, dogFoodName, dogFoodBonus, dogFoodRemaining,
                canSteal, stealCooldown, todayStealCount, stealRate,
                totalSignDays, consecutiveDays, isNewPlayer
            };
        }
    }).mount('#app');
</script>

</body>
</html>
